<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhập / Sửa Điểm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Nhập / Sửa Điểm</h1>
        <form id="edit-score-form">
            <div class="row mb-3">
                <div class="col">
                    <label for="subject-select" class="form-label">Môn học</label>
                    <select class="form-select" id="subject-select" disabled>
                        <option value="">Chọn môn học</option>
                    </select>
                </div>
                <div class="col">
                    <label for="class-select" class="form-label">Lớp</label>
                    <select class="form-select" id="class-select" disabled>
                        <option value="">Chọn lớp</option>
                    </select>
                </div>
                <div class="col">
                    <label for="semester-select" class="form-label">Học kỳ</label>
                    <select class="form-select" id="semester-select" disabled>
                        <option value="">Chọn học kỳ</option>
                    </select>
                </div>
            </div>

            <!-- Thêm phần hiển thị bảng điểm -->
            <div class="mb-4">
                <h3 class="text-center">BẢNG ĐIỂM MÔN HỌC</h3>
                <div class="row mb-2">
                    <div class="col">
                        <strong>Lớp:</strong> <span id="class-info">.................................</span>
                    </div>
                    <div class="col">
                        <strong>Môn:</strong> <span id="subject-info">.................................</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <strong>Học kỳ:</strong> <span id="semester-info">...............................</span>
                    </div>
                    <div class="col">
                        <strong>Năm học:</strong> <span id="school-year-info">2023-2024</span>
                    </div>
                </div>
            </div>

            <!-- Bảng điểm -->
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Họ và tên</th>
                            <th>Điểm 15 phút</th>
                            <th>Điểm 1 tiết</th>
                            <th>Điểm thi</th>
                        </tr>
                    </thead>
                    <tbody id="student-table">
                        <tr>
                            <td colspan="5" class="text-center">Vui lòng chọn môn học, lớp, và học kỳ.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Load subjects for current teacher
            $.getJSON('/get_subjects', function(data) {
                const subjectSelect = $('#subject-select');
                subjectSelect.removeAttr('disabled');
                data.forEach(subject => {
                    subjectSelect.append(`<option value="${subject.id}">${subject.name}</option>`);
                });
            });

            // Load classes based on selected subject
            $('#subject-select').on('change', function() {
                const subjectId = $(this).val();
                if (subjectId) {
                    // Update subject info
                    const subjectName = $(this).find("option:selected").text();
                    $('#subject-info').text(subjectName);

                    $.getJSON(`/get_classes?subject_id=${subjectId}`, function(data) {
                        const classSelect = $('#class-select');
                        classSelect.empty().append('<option value="">Chọn lớp</option>').removeAttr('disabled');
                        data.forEach(cls => {
                            classSelect.append(`<option value="${cls.id}">${cls.name}</option>`);
                        });
                    });

                    $.getJSON(`/get_semesters?subject_id=${subjectId}`, function(data) {
                        const semesterSelect = $('#semester-select');
                        semesterSelect.empty().append('<option value="">Chọn học kỳ</option>').removeAttr('disabled');
                        data.forEach(semester => {
                            semesterSelect.append(`<option value="${semester.id}">${semester.name}</option>`);
                        });
                    });
                }
            });

            // Update class and semester info
            $('#class-select').on('change', function() {
                const className = $(this).find("option:selected").text();
                $('#class-info').text(className);
            });

            $('#semester-select').on('change', function() {
                const semesterName = $(this).find("option:selected").text();
                $('#semester-info').text(semesterName);
            });

            // Load students based on selected class and subject
            $('#class-select, #semester-select').on('change', function() {
                const classId = $('#class-select').val();
                const subjectId = $('#subject-select').val();
                if (classId && subjectId) {
                    $.getJSON(`/get_students?class_id=${classId}&subject_id=${subjectId}`, function(data) {
                        const studentTable = $('#student-table');
                        studentTable.empty();
                        if (data.length > 0) {
                            data.forEach((student, index) => {
                                studentTable.append(`
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${student.name}</td>
                                        <td><input type="text" class="form-control" /></td>
                                        <td><input type="text" class="form-control" /></td>
                                        <td><input type="text" class="form-control" /></td>
                                    </tr>
                                `);
                            });
                        } else {
                            studentTable.append('<tr><td colspan="5" class="text-center">Không có học sinh nào.</td></tr>');
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
